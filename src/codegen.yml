schema:
  - ${SYFR_API_URL}:
      headers:
        apikey: ${SYFR_API_KEY}
documents: ${SYFR_API_CODEGEN_PATH}/src/*.graphql
overwrite: true
generates:
  ${SYFR_API_SDK_PATH}/reactQuery.ts:
    plugins:
      - typescript
      - typescript-operations
      - typescript-react-query
      - add:
          placement: "prepend"
          content: >
            /*****************************************
             * DO NOT EDIT.  This is a generated file.
             *****************************************/
      - add:
          placement: "append"
          content: >
            /*
             * JWK type is better than JsonWebKey type.  
             * ex: JsonWebKey type doesn't recognize `kid` property.
             * @see https://github.com/microsoft/TypeScript/issues/26854  
             */
            import { JWK } from "jose/webcrypto/types";

            /**
             * JWK / JsonWebKey extended with Syfr requirements
             *
             * `kid` must use sha256 fingerprinting (except local key): @see https://github.com/syfrapp/api/issues/77 
             * `use` and `key_ops` required: @see https://github.com/syfrapp/api/issues/84 
             * `jwk` spec: @see https://datatracker.ietf.org/doc/html/rfc7517 
             * `kid` spec: @see https://datatracker.ietf.org/doc/html/rfc7638 
             */
            export interface SyfrJwk extends JWK {
              use: "enc";
              key_ops: Array<"wrapKey" | "unwrapKey">;
              kid: string;
            }
    config:
      fetcher: graphql-request
      exposeQueryKeys: true
      preResolveTypes: true
      skipTypename: true
      scalars:
        CompactJWE: string
        DateTime: string
        Email: string
        JWK: JWK
        JWT: string
        Map: object
        UUID: string
        Url: string
        Void: null
  ${SYFR_API_SDK_PATH}/graphqlRequest.ts:
    #https://graphql-code-generator.com/docs/plugins/typescript-react-query#usage-examples
    plugins:
      - typescript
      - typescript-operations
      - typescript-graphql-request
      - add:
          placement: "prepend"
          content: >
            /*****************************************
             * DO NOT EDIT.  This is a generated file.
             *****************************************/
      - add:
          placement: "append"
          content: >
            /*
             * JWK type is better than JsonWebKey type.  
             * ex: JsonWebKey type doesn't recognize `kid` property.
             * @see https://github.com/microsoft/TypeScript/issues/26854  
             */
            import { JWK } from "jose/webcrypto/types";

            /**
             * JWK / JsonWebKey extended with Syfr requirements
             *
             * `kid` must use sha256 fingerprinting (except local key): @see https://github.com/syfrapp/api/issues/77 
             * `use` and `key_ops` required: @see https://github.com/syfrapp/api/issues/84 
             * `jwk` spec: @see https://datatracker.ietf.org/doc/html/rfc7517 
             * `kid` spec: @see https://datatracker.ietf.org/doc/html/rfc7638 
             */
            export interface SyfrJwk extends JWK {
              use: "enc";
              key_ops: Array<"wrapKey" | "unwrapKey">;
              kid: string;
            }
    config:
      preResolveTypes: true
      scalars:
        CompactJWE: string
        DateTime: string
        Email: string
        JWK: JWK
        JWT: string
        Map: object
        UUID: string
        Url: string
        Void: null
